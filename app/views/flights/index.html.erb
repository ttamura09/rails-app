<% @page_title = t("flights.page_title") %>
<h1><%= @page_title %></h1>

<!--フライト検索フォーム-->
<%= render "shared/flights_search_form" %>

<% bookable_flights_count = 0 %>
<table class="list">
  <tr>
    <th><%= t("flights.table.name") %></th>
    <th><%= t("flights.table.origin_destination") %></th>
    <th><%= t("flights.table.date") %></th>
    <th><%= t("flights.table.times") %></th>
    <th><%= t("flights.table.seats") %></th>
    <th><%= t("flights.table.price") %></th>
    <th><%= t("flights.table.booking_link") %></th>
  </tr>
  <% @flights.each do |flight| %>
    <tr>
      <% seat_nums = flight.calc_seat_nums(params[:seat_class]) %>
      <% next if seat_nums == 0 %>
      <% bookable_flights_count += 1 %>

      <td><%= flight.name %></td>
      <td><%= "#{flight.origin.name} → #{flight.destination.name}" %></td>
      <td><%= flight.departure_date.strftime("%Y/%m/%d") %></td>
      <td><%= "#{flight.departure_time.strftime("%H:%M")} → #{flight.arrival_time.strftime("%H:%M")}" %></td>
      <td><%= (seat_nums >= 10 ? t("flights.table.seats_available") : "#{seat_nums} #{t("flights.table.seats_left")}") %></td>
      <% if params[:seat_class].present? %>
        <td><%= "¥#{flight.sum_price(params[:seat_class])}" %></td>
      <% else %>
        <td>
          <%= "¥#{flight.price}" %><br>
          <%= "¥#{flight.price + 2000}" %><br>
          <%= "¥#{flight.price + 10000}" %><br>
        </td>
      <% end %>
      <% if params[:seat_class].present? %>
        <td>
          <%= form_tag [:new, flight, :booking], method: :get do %>
            <%= hidden_field_tag :seat_class, params[:seat_class] %>
            <%= hidden_field_tag :number_of_passengers, params[:number_of_passengers] %>
            <%= submit_tag t("flights.table.book_now") %>
          <% end %>
        </td>
      <% else %>
        <td>
          <%= form_tag [:new, flight, :booking], method: :get do %>
            <%= radio_button_tag "seat_class", "economy", true %>
            <%= label_tag "seat_class_economy", t("flights.table.options.economy") %><br>
            <%= radio_button_tag "seat_class", "business" %>
            <%= label_tag "seat_class_business", t("flights.table.options.business") %><br>
            <%= radio_button_tag "seat_class", "first" %>
            <%= label_tag "seat_class_first", t("flights.table.options.first") %>
            <%= hidden_field_tag :number_of_passengers, params[:number_of_passengers] %>
            <%= submit_tag t("flights.table.book_now") %>
          <% end %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>

<% if bookable_flights_count == 0 %>
  <p><%= t("flights.no_flights") %></p>
<% end %>